<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>BUSN1101 Shark Demo Day Feedback</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

<!-- jsPDF + autoTable for PDF generation -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

<style>
:root {
  --bg: #f7f7f7;
  --text: #111;
  --card: #fff;
  --border: #ccc;
  --accent: #cc0000;
  --nav-bg: #fff;
  --nav-text: #000;
  --nav-border: #cc0000;
}

body.dark {
  --bg: #1c1c1c;
  --text: #f2f2f2;
  --card: #2a2a2a;
  --border: #555;
  --accent: #cc0000;
  --nav-bg: #222;
  --nav-text: #fff;
  --nav-border: #444;
}

body.northeastern {
  --bg: #faf6f6;
  --text: #111;
  --card: #fff;
  --border: #cc0000;
  --accent: #cc0000;
  --nav-bg: #cc0000;
  --nav-text: #fff;
  --nav-border: #000;
}

body {
  margin: 0;
  background: var(--bg);
  font-family: Inter, sans-serif;
  color: var(--text);
}

/* NAVBAR */
nav {
  background: var(--nav-bg);
  border-bottom: 4px solid var(--nav-border);
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 8px 20px;
  position: sticky;
  top: 0;
  z-index: 999;
}

.nav-left {
  display: flex;
  align-items: center;
}

nav img {
  height: 60px;
  margin-right: 20px;
}

nav a {
  margin-right: 22px;
  text-decoration: none;
  color: var(--nav-text);
  font-size: 15px;
  cursor: pointer;
}

nav a:hover {
  color: var(--accent);
}

.theme-select {
  font-size: 14px;
  padding: 6px 10px;
  border-radius: 6px;
  border: 1px solid var(--border);
  background: var(--card);
  color: var(--text);
}

/* LAYOUT */
#container {
  display: flex;
  height: calc(100vh - 80px);
}

#sidebar {
  width: 220px;
  background: var(--card);
  border-right: 1px solid var(--border);
  overflow-y: auto;
  padding: 15px;
}

.group-tab {
  padding: 12px;
  background: #efefef;
  border-radius: 8px;
  margin-bottom: 10px;
  cursor: pointer;
  font-weight: 600;
  position: relative;
  text-align: center;
}

.group-tab:hover .tab-delete {
  opacity: 1;
}

.tab-delete {
  position: absolute;
  top: 4px;
  right: 6px;
  font-weight: 900;
  cursor: pointer;
  opacity: 0;
}

.add-group-btn {
  width: 100%;
  border: none;
  background: var(--nav-text);
  color: var(--nav-bg);
  padding: 10px;
  border-radius: 8px;
  margin-top: 10px;
  cursor: pointer;
}

/* MAIN EDITOR */
#main {
  flex: 1;
  padding: 22px;
  overflow-y: auto;
}

.group-name-input {
  font-size: 24px;
  font-weight: 700;
  width: 100%;
  border: none;
  background: transparent;
  color: var(--text);
}

.group-name-input:focus {
  outline: none;
}

.group-feedback-box {
  width: 100%;
  border: 1px solid var(--border);
  padding: 12px;
  border-radius: 10px;
  font-size: 14px;
  min-height: 60px;
  resize: none;
  overflow: hidden;
  margin-bottom: 20px;
  background: var(--card);
}

/* PRESENTERS */
.presenter-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
}

.presenter-card {
  width: 180px;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 10px;
  position: relative;
}

.presenter-delete {
  position: absolute;
  top: 6px;
  right: 8px;
  font-weight: 900;
  color: var(--accent);
  cursor: pointer;
  opacity: 0;
}

.presenter-card:hover .presenter-delete {
  opacity: 1;
}

.presenter-card input {
  width: 100%;
  border: none;
  font-weight: 700;
  font-size: 15px;
  background: transparent;
}

/* sliders */
.slider-row {
  margin-bottom: 6px;
}

.slider-row label {
  font-size: 13px;
}

.slider-value {
  float: right;
  font-weight: 600;
}

.slider-row input[type="range"] {
  width: 100%;
}

/* notes */
.presenter-notes {
  width: 100%;
  border: 1px solid var(--border);
  border-radius: 8px;
  min-height: 40px;
  resize: none;
  padding: 4px;
  font-size: 11px;
  overflow: hidden;
}

/* RESULTS */
#resultsPage {
  display: none;
  padding: 20px;
}

.summary-group {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 12px;
  margin-bottom: 16px;
}

.summary-header {
  padding: 12px;
  font-size: 17px;
  font-weight: 700;
  display: flex;
  justify-content: space-between;
  cursor: pointer;
}

.summary-content {
  display: none;
  padding: 14px;
}

table {
  width: 100%;
  border-collapse: collapse;
}

td, th {
  border: 1px solid var(--border);
  padding: 6px;
  font-size: 13px;
  vertical-align: top;
}

/* BUTTONS */
.btn {
  background: var(--accent);
  border: none;
  padding: 8px 12px;
  color: white;
  border-radius: 8px;
  cursor: pointer;
  margin-top: 10px;
}

.csv-btn {
  background: #000;
}
.pdf-btn {
  background: #000;
  margin-left: 8px;
}
</style>
</head>

<body>

<nav>
  <div class="nav-left">
    <img src="Northeastern-University-Logo-1922.png">
    <a onclick="showDashboard()">Dashboard</a>
    <a onclick="showResults()">Results</a>
  </div>

  <select class="theme-select" onchange="changeTheme(this.value)">
    <option value="light">Theme: Light</option>
    <option value="dark">Dark</option>
    <option value="northeastern">Northeastern</option>
  </select>
</nav>

<div id="container">
  <div id="sidebar"></div>
  <div id="main"></div>
</div>

<div id="resultsPage"></div>

<script>
let groupColors = ["#ffd6d6","#ffe7c6","#fff6a8","#d7f7d6","#d6e7ff"];
let groups = [];

function createGroup(n){
  return {
    id: "group"+n,
    name: "Group "+n,
    color: groupColors[(n-1)%groupColors.length],
    feedback: "",
    presenters: [
      makePresenter(1),
      makePresenter(2),
      makePresenter(3),
      makePresenter(4),
      makePresenter(5)
    ]
  };
}

function makePresenter(n){
  return {
    id: "p"+n,
    name: "Presenter "+n,
    scores: {},
    notes: ""
  };
}

groups.push(createGroup(1));

function changeTheme(v){
  document.body.classList.remove("dark","northeastern");
  if(v==="dark") document.body.classList.add("dark");
  if(v==="northeastern") document.body.classList.add("northeastern");
}

function showDashboard(){
  document.getElementById("resultsPage").style.display = "none";
  document.getElementById("container").style.display = "flex";
  renderSidebar();
  renderGroupEditor(groups[0].id);
}

function showResults(){
  document.getElementById("container").style.display = "none";
  document.getElementById("resultsPage").style.display = "block";
  renderResults();
}

function renderSidebar(){
  const bar = document.getElementById("sidebar");
  bar.innerHTML = "";

  groups.forEach(g=>{
    let tab = document.createElement("div");
    tab.className = "group-tab";
    tab.style.background = g.color;
    tab.innerHTML = `
      ${g.name}
      <span class="tab-delete" onclick="deleteGroup('${g.id}',event)">✕</span>
    `;
    tab.onclick = ()=>renderGroupEditor(g.id);
    bar.appendChild(tab);
  });

  let add = document.createElement("button");
  add.className = "add-group-btn";
  add.innerText = "Add Group";
  add.onclick = ()=>{
    let ng = createGroup(groups.length+1);
    groups.push(ng);
    renderSidebar();
    renderGroupEditor(ng.id);
  };
  bar.appendChild(add);
}

function deleteGroup(id,e){
  e.stopPropagation();
  if(!confirm("Delete this group?"))return;
  groups = groups.filter(g=>g.id!==id);
  if(groups.length===0) groups.push(createGroup(1));
  renderSidebar();
  renderGroupEditor(groups[0].id);
}

function renderGroupEditor(id){
  const g = groups.find(x=>x.id===id);
  const main = document.getElementById("main");

  main.innerHTML = `
    <input class="group-name-input" value="${g.name}"
      oninput="updateGroupName('${id}',this.value)">

    <label>Group Feedback:</label>
    <textarea id="gf" class="group-feedback-box"></textarea>

    <h3>Presenters</h3>
    <div class="presenter-grid" id="presenterGrid"></div>

    <button class="btn" onclick="addPresenter('${id}')">Add Presenter</button>
    <br><br>

    <button class="btn csv-btn" onclick="exportGroupCSV('${id}')">
      Download This Group (CSV)
    </button>
    <button class="btn pdf-btn" onclick="downloadGroupPDF('${id}')">
      Download This Group (PDF)
    </button>
  `;

  let gf = document.getElementById("gf");
  gf.value = g.feedback;
  gf.oninput = e=>{
    g.feedback = e.target.value;
    autoExpand(e.target);
  };
  autoExpand(gf);

  let grid=document.getElementById("presenterGrid");
  g.presenters.forEach(p=>{
    let card=document.createElement("div");
    card.className="presenter-card";

    card.innerHTML=`
      <span class="presenter-delete" onclick="deletePresenter('${id}','${p.id}',event)">✕</span>
      <input value="${p.name}" oninput="updatePresenterName('${id}','${p.id}',this.value)">

      ${slider("Eye contact",p.scores["Eye contact"]||0,id,p.id)}
      ${slider("Clarity",p.scores["Clarity"]||0,id,p.id)}
      ${slider("Pace",p.scores["Pace"]||0,id,p.id)}
      ${slider("Confidence",p.scores["Confidence"]||0,id,p.id)}
      ${slider("Engagement",p.scores["Engagement"]||0,id,p.id)}
    `;

    let notes=document.createElement("textarea");
    notes.className="presenter-notes";
    notes.value=p.notes;
    notes.oninput=e=>{
      p.notes=e.target.value;
      autoExpand(e.target);
    };
    autoExpand(notes);

    card.appendChild(notes);
    grid.appendChild(card);
  });

  renderSidebar();
}

function slider(label,val,gid,pid){
  return `
    <div class="slider-row">
      <label>${label}<span class="slider-value">${val}</span></label>
      <input type="range" min="0" max="10" value="${val}"
        oninput="updateSlider('${gid}','${pid}','${label}',this)">
    </div>
  `;
}

function deletePresenter(gid,pid,e){
  e.stopPropagation();
  if(!confirm("Delete this presenter?"))return;
  let g=groups.find(x=>x.id===gid);
  g.presenters=g.presenters.filter(p=>p.id!==pid);
  renderGroupEditor(gid);
}

function updateGroupName(id,val){
  groups.find(x=>x.id===id).name = val;
  renderSidebar();
}

function updatePresenterName(gid,pid,val){
  let g=groups.find(x=>x.id===gid);
  g.presenters.find(x=>x.id===pid).name = val;
}

function updateSlider(gid,pid,label,input){
  let g=groups.find(x=>x.id===gid);
  let p=g.presenters.find(x=>x.id===pid);
  p.scores[label] = parseInt(input.value);
  input.previousElementSibling.querySelector(".slider-value").innerText = input.value;
}

function addPresenter(gid){
  let g=groups.find(x=>x.id===gid);
  g.presenters.push(makePresenter(g.presenters.length+1));
  renderGroupEditor(gid);
}

function autoExpand(el){
  el.style.height="auto";
  el.style.height=el.scrollHeight+"px";
}

function renderResults(){
  const box = document.getElementById("resultsPage");
  box.innerHTML = `
    <h2>Results</h2>
    <button class="btn csv-btn" onclick="exportAllCSV()">Download All Groups (CSV)</button>
    <button class="btn pdf-btn" onclick="downloadAllPDF()">Download All Groups (PDF)</button>
    <br><br>
  `;

  groups.forEach(g=>{
    let wrap=document.createElement("div");
    wrap.className="summary-group";

    let head=document.createElement("div");
    head.className="summary-header";
    head.innerHTML=`${g.name}<span>▼</span>`;
    head.onclick=()=>{
      let c=document.getElementById("sum-"+g.id);
      c.style.display = (c.style.display==="block") ? "none" : "block";
    };

    let content=document.createElement("div");
    content.className="summary-content";
    content.id="sum-"+g.id;

    let feedbackHtml = (g.feedback || "").replace(/\n/g,"<br>");

    let html = `
      <strong>Group Feedback:</strong><br>
      <div style="margin-bottom:8px;">${feedbackHtml}</div>

      <table>
        <tr>
          <th>Presenter</th>
          <th>Eye contact</th>
          <th>Clarity</th>
          <th>Pace</th>
          <th>Confidence</th>
          <th>Engagement</th>
          <th>Total</th>
          <th>Notes</th>
        </tr>
    `;

    g.presenters.forEach(p=>{
      let s=p.scores;
      let total=
        (s["Eye contact"]||0)+
        (s["Clarity"]||0)+
        (s["Pace"]||0)+
        (s["Confidence"]||0)+
        (s["Engagement"]||0);

      let notesHtml = (p.notes || "").replace(/\n/g,"<br>");

      html+=`
        <tr>
          <td>${p.name}</td>
          <td>${s["Eye contact"]||0}</td>
          <td>${s["Clarity"]||0}</td>
          <td>${s["Pace"]||0}</td>
          <td>${s["Confidence"]||0}</td>
          <td>${s["Engagement"]||0}</td>
          <td>${total}</td>
          <td>${notesHtml}</td>
        </tr>
      `;
    });

    html+="</table>";
    content.innerHTML = html;

    wrap.appendChild(head);
    wrap.appendChild(content);
    box.appendChild(wrap);
  });
}

/* CSV */
function exportAllCSV(){
  let rows=[];
  groups.forEach(g=>{
    rows.push([`${g.name} Feedback`, g.feedback]);
    rows.push(["Presenter","Eye contact","Clarity","Pace","Confidence","Engagement","Total","Notes"]);
    g.presenters.forEach(p=>{
      let s=p.scores;
      let total=
        (s["Eye contact"]||0)+
        (s["Clarity"]||0)+
        (s["Pace"]||0)+
        (s["Confidence"]||0)+
        (s["Engagement"]||0);
      rows.push([
        p.name,
        s["Eye contact"]||0,
        s["Clarity"]||0,
        s["Pace"]||0,
        s["Confidence"]||0,
        s["Engagement"]||0,
        total,
        p.notes.replace(/"/g,"'")
      ]);
    });
    rows.push([]);
  });

  downloadCSV(rows,"All_Groups.csv");
}

function exportGroupCSV(id){
  let g=groups.find(x=>x.id===id);
  let rows=[];
  rows.push([`${g.name} Feedback`, g.feedback]);
  rows.push(["Presenter","Eye contact","Clarity","Pace","Confidence","Engagement","Total","Notes"]);

  g.presenters.forEach(p=>{
    const s=p.scores;
    const total=
      (s["Eye contact"]||0)+
      (s["Clarity"]||0)+
      (s["Pace"]||0)+
      (s["Confidence"]||0)+
      (s["Engagement"]||0);

    rows.push([
      p.name,
      s["Eye contact"]||0,
      s["Clarity"]||0,
      s["Pace"]||0,
      s["Confidence"]||0,
      s["Engagement"]||0,
      total,
      p.notes.replace(/"/g,"'")
    ]);
  });

  downloadCSV(rows,`${g.name}.csv`);
}

function downloadCSV(rows,filename){
  let csv = rows.map(r=>r.map(v=>`"${v}"`).join(",")).join("\n");
  let blob=new Blob([csv],{type:"text/csv"});
  let url=URL.createObjectURL(blob);
  let a=document.createElement("a");
  a.href=url;
  a.download=filename;
  a.click();
}

/* PDF: All groups */
function downloadAllPDF(){
  const { jsPDF } = window.jspdf;
  let doc=new jsPDF();

  let y=10;
  groups.forEach((g,index)=>{
    if(index>0){
      doc.addPage();
      y=10;
    }

    doc.setFontSize(16);
    doc.text(`All Groups — ${g.name}`,10,y);
    y+=8;

    doc.setFontSize(12);
    let feedbackLines=(g.feedback||"").split("\n");
    feedbackLines.forEach(line=>{
      if(line.trim()!==""){
        doc.text(line,10,y);
        y+=6;
      }
    });
    y+=4;

    let rows=g.presenters.map(p=>{
      const s=p.scores;
      const total=
        (s["Eye contact"]||0)+
        (s["Clarity"]||0)+
        (s["Pace"]||0)+
        (s["Confidence"]||0)+
        (s["Engagement"]||0);
      const notesLines=(p.notes||"").split("\n").filter(x=>x.trim()!=="");
      const notesCombined=notesLines.join(" | ");
      return [
        p.name,
        s["Eye contact"]||0,
        s["Clarity"]||0,
        s["Pace"]||0,
        s["Confidence"]||0,
        s["Engagement"]||0,
        total,
        notesCombined
      ];
    });

    doc.autoTable({
      head:[["Presenter","Eye contact","Clarity","Pace","Confidence","Engagement","Total","Notes"]],
      body:rows,
      startY:y,
      styles:{fontSize:10}
    });
  });

  doc.save("All_Groups_Feedback.pdf");
}

/* PDF: single group */
function downloadGroupPDF(id){
  const { jsPDF } = window.jspdf;
  let g=groups.find(x=>x.id===id);
  let doc=new jsPDF();

  let y=10;

  doc.setFontSize(16);
  doc.text(`Group Feedback — ${g.name}`,10,y);
  y+=8;

  doc.setFontSize(12);
  let feedbackLines=(g.feedback||"").split("\n");
  feedbackLines.forEach(line=>{
    if(line.trim()!==""){
      doc.text(line,10,y);
      y+=6;
    }
  });
  y+=4;

  let rows=g.presenters.map(p=>{
    const s=p.scores;
    const total=
      (s["Eye contact"]||0)+
      (s["Clarity"]||0)+
      (s["Pace"]||0)+
      (s["Confidence"]||0)+
      (s["Engagement"]||0);
    const notesLines=(p.notes||"").split("\n").filter(x=>x.trim()!=="");
    const notesCombined=notesLines.join(" | ");

    return [
      p.name,
      s["Eye contact"]||0,
      s["Clarity"]||0,
      s["Pace"]||0,
      s["Confidence"]||0,
      s["Engagement"]||0,
      total,
      notesCombined
    ];
  });

  doc.autoTable({
    head:[["Presenter","Eye contact","Clarity","Pace","Confidence","Engagement","Total","Notes"]],
    body:rows,
    startY:y,
    styles:{fontSize:10}
  });

  doc.save(`${g.name.replace(/ /g,"_")}_Feedback.pdf`);
}

showDashboard();
</script>

</body>
</html>
